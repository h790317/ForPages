<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’ç®¡å¾Œ CXR ç¢ºèªä½ç½®äº’å‹•æŒ‡å—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom styles for specific chart constraints */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        body {
            font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
            background-color: #f8fafc; /* Warm/Neutral light gray */
            color: #334155;
        }
        .interactive-card {
            transition: all 0.3s ease;
        }
        .interactive-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Custom Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #0ea5e9;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 0 2px rgba(0,0,0,0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1;
            border-radius: 2px;
        }
    </style>
    <!-- Chosen Palette: Slate & Sky (Neutral warm background #f8fafc with #0ea5e9 accents for medical cleanliness) -->
    <!-- Updated Structure Plan: 
         1. Header: Core question.
         2. Simulator: Visual "Why".
         3. Anatomy Logic: Context.
         4. GUIDELINES (NEW): Official "Rules" (ACR, ASA, ATLS).
         5. Data Insight: Statistical "Frequency".
         6. Head Physiology: Dynamic nuance.
         7. Summary.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Navigation / Header -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <span class="text-2xl text-sky-600 font-bold">ğŸ« AirwayChk</span>
                <h1 class="text-lg font-semibold text-slate-700 hidden sm:block">æ°£ç®¡å…§ç®¡ä½ç½®ç¢ºèªæŒ‡å—</h1>
            </div>
            <div class="text-sm font-medium text-slate-500">
                è‡¨åºŠæ•™å­¸äº’å‹•ç³»çµ±
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="max-w-5xl mx-auto px-4 py-8 space-y-12">

        <!-- Intro Section -->
        <section class="text-center max-w-3xl mx-auto">
            <h2 class="text-3xl font-bold text-slate-900 mb-4">Intubation å¾Œï¼Œç‚ºä½•å¿…é ˆç…§ CXRï¼Ÿ</h2>
            <p class="text-lg text-slate-600 leading-relaxed">
                æ°£ç®¡å…§ç®¡æ’ç®¡ï¼ˆEndotracheal Intubationï¼‰æ˜¯æ€¥æ•‘èˆ‡éº»é†‰çš„é—œéµè™•ç½®ã€‚é›–ç„¶è½è¨ºèˆ‡ Capnography (äºŒæ°§åŒ–ç¢³æ¿ƒåº¦ç›£æ¸¬) èƒ½ç¢ºèªæ°£ç®¡ä½ç½®ï¼Œä½† **èƒ¸éƒ¨Xå…‰ (CXR)** æ‰æ˜¯ç¢ºèªã€Œæ·±åº¦ã€èˆ‡æ’é™¤ä½µç™¼ç—‡çš„é»ƒé‡‘æ¨™æº–ã€‚æœ¬äº’å‹•æŒ‡å—å°‡å¸¶æ‚¨æ¢ç´¢è§£å‰–çµæ§‹ã€å¯¦è­‰æŒ‡å¼•èˆ‡æ½›åœ¨é¢¨éšªã€‚
            </p>
        </section>

        <!-- SECTION 1: Interactive Airway Simulator -->
        <section class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
            <div class="p-6 md:p-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Controls & Context -->
                <div class="col-span-1 space-y-6 flex flex-col justify-center">
                    <div>
                        <h3 class="text-xl font-bold text-sky-700 mb-2">ğŸ‘ï¸ æ·±åº¦æ¨¡æ“¬å™¨</h3>
                        <p class="text-sm text-slate-500 mb-4">
                            æ‹–å‹•æ»‘æ¡¿èª¿æ•´æ°£ç®¡å…§ç®¡ (Endotracheal Tube) çš„æ·±åº¦ï¼Œè§€å¯Ÿå…¶èˆ‡éš†çª (Carina) çš„ç›¸å°ä½ç½®ã€‚
                        </p>
                    </div>

                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                        <label for="tubeDepthSlider" class="block text-sm font-medium text-slate-700 mb-2">
                            æ’å…¥æ·±åº¦ (cm @ Lip)
                        </label>
                        <input type="range" id="tubeDepthSlider" min="18" max="28" step="0.5" value="21" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-slate-400 mt-1">
                            <span>æ·º (18cm)</span>
                            <span>æ·± (28cm)</span>
                        </div>
                    </div>

                    <div id="feedbackBox" class="p-4 rounded-lg border-l-4 border-green-500 bg-green-50 transition-colors duration-300">
                        <h4 class="font-bold text-green-800" id="statusTitle">ä½ç½®å®Œç¾ (Ideal)</h4>
                        <p class="text-sm text-green-700 mt-1" id="statusDesc">
                            å°–ç«¯ä½æ–¼éš†çª (Carina) ä¸Šæ–¹ 3-5 å…¬åˆ†è™•ã€‚é›™å´è‚ºéƒ¨é€šæ°£è‰¯å¥½ã€‚
                        </p>
                    </div>
                </div>

                <!-- Canvas Visualization -->
                <div class="col-span-1 lg:col-span-2 flex justify-center items-center bg-slate-900 rounded-xl relative overflow-hidden" style="min-height: 400px;">
                    <canvas id="airwayCanvas" width="600" height="400" class="max-w-full h-auto"></canvas>
                    <div class="absolute bottom-4 right-4 text-xs text-slate-400 bg-black/50 px-2 py-1 rounded">
                        Schematic View (Anterior-Posterior)
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: Key Anatomy & Complications Logic -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-amber-400 interactive-card">
                <div class="flex items-start space-x-4">
                    <div class="text-4xl">ğŸ“</div>
                    <div>
                        <h3 class="text-lg font-bold text-slate-800 mb-2">ç‚ºä»€éº¼å®¹æ˜“ç™¼ç”Ÿã€Œå³æ”¯æ°£ç®¡æ’ç®¡ã€ï¼Ÿ</h3>
                        <p class="text-slate-600 text-sm leading-relaxed mb-4">
                            è§£å‰–å­¸ä¸Šï¼Œ**å³ä¸»æ”¯æ°£ç®¡ (Right Main Bronchus)** è¼ƒç²—ã€è¼ƒçŸ­ï¼Œä¸”èˆ‡æ°£ç®¡çš„è§’åº¦è¼ƒå‚ç›´ï¼ˆç´„ 25Â°ï¼‰ï¼Œå¹¾ä¹æ˜¯æ°£ç®¡çš„ç›´ç·šå»¶ä¼¸ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå·¦ä¸»æ”¯æ°£ç®¡è§’åº¦è¼ƒå¤§ï¼ˆç´„ 45Â°ï¼‰ã€‚
                        </p>
                        <div class="bg-amber-50 p-3 rounded text-xs text-amber-800 font-medium">
                            âš ï¸ ç•¶ç®¡è·¯æ’å¤ªæ·±æ™‚ï¼Œè¶…é 90% çš„æ©Ÿç‡æœƒæ»‘å…¥å³å´ï¼Œå°è‡´å·¦è‚ºå¡Œé™· (Atelectasis)ã€‚
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-rose-400 interactive-card">
                <div class="flex items-start space-x-4">
                    <div class="text-4xl">ğŸš‘</div>
                    <div>
                        <h3 class="text-lg font-bold text-slate-800 mb-2">é™¤äº†ä½ç½®ï¼Œé‚„è¦çœ‹ä»€éº¼ï¼Ÿ</h3>
                        <p class="text-slate-600 text-sm leading-relaxed mb-2">
                            CXR ä¸åƒ…ç¢ºèªæ·±åº¦ï¼Œé‚„ç”¨æ–¼åµæ¸¬ä½µç™¼ç—‡ï¼š
                        </p>
                        <ul class="list-disc list-inside text-sm text-slate-600 space-y-1">
                            <li><span class="font-semibold text-slate-700">æ°£èƒ¸ (Pneumothorax):</span> æ’ç®¡éç¨‹å¯èƒ½å› å£“åŠ›å‚·æˆ–æ“ä½œé€ æˆã€‚</li>
                            <li><span class="font-semibold text-slate-700">é£Ÿé“æ’ç®¡ (Esophageal):</span> é›–ç„¶ä¸»è¦é  EtCO2 æ’é™¤ï¼Œä½† CXR å¯è¦‹èƒƒéƒ¨ç•°å¸¸å……æ°£ã€‚</li>
                            <li><span class="font-semibold text-slate-700">æ°£å›Š (Cuff) å¯¬åº¦:</span> é¿å…éåº¦å……æ°£å£“è¿«æ°£ç®¡å£ã€‚</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Guidelines & Standards (NEW) -->
        <section class="bg-slate-800 text-slate-100 rounded-2xl shadow-xl overflow-hidden">
            <div class="p-6 md:p-8 bg-slate-900 border-b border-slate-700">
                <h2 class="text-2xl font-bold text-white flex items-center">
                    <span class="mr-3">ğŸ“œ</span> æ¬Šå¨æŒ‡å¼•èˆ‡è‡¨åºŠé»ƒé‡‘æ¨™æº– (Guidelines)
                </h2>
                <p class="text-slate-400 mt-2 text-sm">
                    ç‚ºä½•è‡¨åºŠä¸Šé€™æ˜¯ä¸€é …æ¨™æº–å‹•ä½œï¼Ÿä»¥ä¸‹å½™æ•´ ACR, ASA, ATLS ä¸‰å¤§æ¬Šå¨æ©Ÿæ§‹çš„å»ºè­°ã€‚
                </p>
            </div>
            
            <div class="p-6 md:p-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- ACR Card -->
                <div class="bg-slate-700/50 p-5 rounded-xl border border-slate-600 hover:border-sky-500 transition">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-sky-400">ACR ç¾åœ‹æ”¾å°„å­¸æœƒ</h3>
                        <span class="bg-sky-500 text-white text-xs font-bold px-2 py-1 rounded">Rating: 9/9</span>
                    </div>
                    <p class="text-xs text-slate-300 mb-3">Appropriateness CriteriaÂ®</p>
                    <p class="text-sm text-slate-200 leading-relaxed">
                        å°æ–¼åŠ è­·ç—…æˆ¿ (ICU) ç—…æ‚£ï¼Œæ’ç®¡å¾ŒåŸ·è¡ŒåºŠé‚Šèƒ¸éƒ¨ X å…‰è¢«è©•ç‚º <strong class="text-white">9åˆ† (Usually Appropriate)</strong>ã€‚é€™æ˜¯ç¢ºèªç®¡è·¯å°–ç«¯èˆ‡éš†çªç›¸å°ä½ç½® (Tip Position) çš„å”¯ä¸€éä¾µå…¥æ€§é»ƒé‡‘æ¨™æº–ã€‚
                    </p>
                </div>

                <!-- ASA Card -->
                <div class="bg-slate-700/50 p-5 rounded-xl border border-slate-600 hover:border-emerald-500 transition">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-emerald-400">ASA ç¾åœ‹éº»é†‰é†«å­¸æœƒ</h3>
                        <span class="bg-emerald-600 text-white text-xs font-bold px-2 py-1 rounded">Difficult Airway</span>
                    </div>
                    <p class="text-xs text-slate-300 mb-3">Practice Guidelines</p>
                    <p class="text-sm text-slate-200 leading-relaxed">
                        æ˜ç¢ºå€åˆ†åŠŸèƒ½ï¼š
                        <br>â€¢ <strong class="text-white">ç¢ºèªæ°£ç®¡å…§:</strong> é  Capnography (ETCO2)ã€‚
                        <br>â€¢ <strong class="text-white">ç¢ºèªæ·±åº¦:</strong> åœ¨ ICU/æ€¥è¨ºè¢«è¦–ç‚ºæ¨™æº–ç…§è­· (Standard of Care)ï¼Œå› ç‚ºè½è¨ºå°æ·±åº¦åˆ¤æ–·èª¤å·®æ¥µå¤§ã€‚
                    </p>
                </div>

                <!-- ATLS Card -->
                <div class="bg-slate-700/50 p-5 rounded-xl border border-slate-600 hover:border-rose-500 transition">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-rose-400">ATLS é«˜ç´šå¤–å‚·æ•‘å‘½è¡“</h3>
                        <span class="bg-rose-600 text-white text-xs font-bold px-2 py-1 rounded">Primary Survey</span>
                    </div>
                    <p class="text-xs text-slate-300 mb-3">Trauma Protocol</p>
                    <p class="text-sm text-slate-200 leading-relaxed">
                        åœ¨å¤–å‚·åˆç´šè©•ä¼°å»ºç«‹ç¢ºåˆ‡å‘¼å¸é“å¾Œï¼ŒCXR ç‚ºå¼·åˆ¶é …ç›®ã€‚
                        <br>é™¤äº†ç¢ºèªç®¡è·¯ä½ç½®ï¼Œé‡é»åœ¨æ–¼<strong class="text-white">æ’é™¤æ°£èƒ¸ (Pneumothorax)</strong> åŠå…¶ä»–èƒ¸è…”å‰µå‚·ã€‚
                    </p>
                </div>
            </div>

            <!-- Comparison Table Area -->
            <div class="bg-slate-800 p-6 border-t border-slate-700">
                <h4 class="text-lg font-bold text-white mb-4">è‡¨åºŠç¢ºèªå·¥å…·æ¯”è¼ƒè¡¨</h4>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-slate-300">
                        <thead class="text-xs text-slate-400 uppercase bg-slate-900/50 border-b border-slate-600">
                            <tr>
                                <th class="px-4 py-3">ç¢ºèªé …ç›®</th>
                                <th class="px-4 py-3 text-sky-400">é»ƒé‡‘æ¨™æº– (Gold Standard)</th>
                                <th class="px-4 py-3">CXR çš„è§’è‰²</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b border-slate-700 hover:bg-slate-700/30">
                                <td class="px-4 py-3 font-medium text-white">æ’å°æ´ (Trachea vs Esophagus)</td>
                                <td class="px-4 py-3 text-emerald-400 font-bold">Capnography (ETCO2)</td>
                                <td class="px-4 py-3">è¼”åŠ© (è‹¥è¦‹èƒƒéƒ¨å……æ°£å¯æ‡·ç–‘ï¼Œéé¦–é¸)</td>
                            </tr>
                            <tr class="border-b border-slate-700 hover:bg-slate-700/30">
                                <td class="px-4 py-3 font-medium text-white">æ’å°æ·±åº¦ (Depth / T3-T4)</td>
                                <td class="px-4 py-3 text-sky-400 font-bold">Chest X-Ray (CXR)</td>
                                <td class="px-4 py-3">å”¯ä¸€æ¨™æº– (è½è¨ºèª¤å·®ç‡é«˜é” 50%)</td>
                            </tr>
                            <tr class="hover:bg-slate-700/30">
                                <td class="px-4 py-3 font-medium text-white">ä½µç™¼ç—‡ (Complications)</td>
                                <td class="px-4 py-3 text-sky-400 font-bold">Chest X-Ray / CT</td>
                                <td class="px-4 py-3">å¿…è¦ (æ’é™¤æ°£èƒ¸ã€ç¸±è†ˆè…”æ°£è…«)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 p-3 bg-rose-900/20 border border-rose-900/50 rounded text-xs text-rose-200">
                    <strong>ğŸ’¡ å¿…é ˆç…§ CXR çš„æƒ…å¢ƒ (Mandatory):</strong> ICU èˆ‡æ€¥è¨ºæ’ç®¡å¾Œã€æ‡·ç–‘æœ‰æ°£èƒ¸/è¡€æ°§ä¸ç©©å®šæ™‚ã€èª¿æ•´ç®¡è·¯æ·±åº¦å¾Œã€‚
                </div>
            </div>
        </section>

        <!-- SECTION 4: Data Visualization (Malposition Rates) -->
        <section class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-center">
                <div class="md:col-span-1">
                    <h3 class="text-2xl font-bold text-slate-800 mb-2">çµ±è¨ˆæ•¸æ“šï¼šç‚ºä½•ä¸èƒ½åªé è½è¨ºï¼Ÿ</h3>
                    <p class="text-slate-600 mb-4 text-sm">
                        æ ¹æ“šé‡ç—‡é†«å­¸ç ”ç©¶çµ±è¨ˆï¼Œé›–ç„¶è‡¨åºŠè½è¨ºå·²åŸ·è¡Œï¼Œä½†åœ¨æ‹æ” CXR å¾Œï¼Œç´„æœ‰ **14% - 15%** çš„æ°£ç®¡å…§ç®¡éœ€è¦èª¿æ•´ä½ç½®ã€‚é€™çªé¡¯äº†å½±åƒå­¸ç¢ºèªçš„ä¸å¯å–ä»£æ€§ã€‚
                    </p>
                    <div class="space-y-2">
                        <button onclick="updateChartData('icu')" class="w-full text-left px-4 py-2 bg-sky-50 hover:bg-sky-100 text-sky-700 rounded-lg text-sm font-medium transition">
                            ğŸ“Š ICU æ•¸æ“š (ä¸€èˆ¬æ’ç®¡)
                        </button>
                        <button onclick="updateChartData('emergency')" class="w-full text-left px-4 py-2 bg-slate-50 hover:bg-slate-100 text-slate-600 rounded-lg text-sm font-medium transition">
                            ğŸ“Š æ€¥è¨ºæ•¸æ“š (ç·Šæ€¥æ’ç®¡)
                        </button>
                    </div>
                    <p class="text-xs text-slate-400 mt-4 italic">* é»æ“Šä¸Šæ–¹æŒ‰éˆ•åˆ‡æ›ä¸åŒæƒ…å¢ƒçš„çµ±è¨ˆæ•¸æ“š (æ¨¡æ“¬æ•¸æ“š)</p>
                </div>
                
                <div class="md:col-span-2 flex justify-center">
                    <div class="chart-container">
                        <canvas id="positionChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 5: Head Positioning Logic -->
        <section class="bg-slate-800 text-white rounded-2xl shadow-xl p-6 md:p-8 overflow-hidden relative">
            <div class="relative z-10">
                <h3 class="text-xl font-bold text-sky-300 mb-2">é ­éƒ¨ä½ç½®çš„å‹•æ…‹å½±éŸ¿</h3>
                <p class="text-slate-300 mb-6 max-w-2xl">
                    ç®¡è·¯å›ºå®šå¾Œä¸¦ééœæ­¢ä¸å‹•ã€‚é ­éƒ¨çš„å±ˆæ›² (Flexion) èˆ‡ä¼¸å±• (Extension) æœƒé¡¯è‘—æ”¹è®Šç®¡è·¯å°–ç«¯çš„ä½ç½®ã€‚å£è¨£ï¼š<span class="text-white font-bold border-b-2 border-sky-400">"The hose follows the nose"</span> (ç®¡å­è·Ÿè‘—é¼»å­èµ°)ã€‚
                </p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Neutral -->
                    <div id="headNeutral" class="cursor-pointer bg-slate-700/50 hover:bg-slate-700 p-4 rounded-xl border border-slate-600 transition head-btn ring-2 ring-sky-500">
                        <div class="font-bold text-lg mb-1">ğŸ˜ ä¸­ç«‹ä½ (Neutral)</div>
                        <div class="text-xs text-slate-400">æ¨™æº–æ¸¬é‡åŸºæº–</div>
                        <div class="mt-3 text-sky-200 text-sm">Tube ä½ç½®ä¸è®Š</div>
                    </div>

                    <!-- Flexion -->
                    <div id="headFlexion" class="cursor-pointer bg-slate-700/50 hover:bg-slate-700 p-4 rounded-xl border border-slate-600 transition head-btn">
                        <div class="font-bold text-lg mb-1">ğŸ™‡ ä½é ­ (Flexion)</div>
                        <div class="text-xs text-slate-400">é¼»å­å‘ä¸‹ç§»å‹•</div>
                        <div class="mt-3 text-emerald-300 text-sm">
                            ç®¡å­è¢«æ¨å‘æ·±è™• (Deep)<br>
                            <span class="text-xs opacity-75">å¹³å‡ç§»å‹• 1.9 cm</span>
                        </div>
                    </div>

                    <!-- Extension -->
                    <div id="headExtension" class="cursor-pointer bg-slate-700/50 hover:bg-slate-700 p-4 rounded-xl border border-slate-600 transition head-btn">
                        <div class="font-bold text-lg mb-1">ğŸ™† ä»°é ­ (Extension)</div>
                        <div class="text-xs text-slate-400">é¼»å­å‘ä¸Šç§»å‹•</div>
                        <div class="mt-3 text-rose-300 text-sm">
                            ç®¡å­è¢«æ‹‰å‘æ·ºè™• (Shallow)<br>
                            <span class="text-xs opacity-75">å¹³å‡ç§»å‹• 1.9 cm</span>
                        </div>
                    </div>
                </div>

                <div class="mt-6 bg-black/30 p-4 rounded-lg text-sm text-slate-300 flex items-center">
                    <span class="text-2xl mr-3">ğŸ’¡</span>
                    è‡¨åºŠæ‡‰ç”¨ï¼šè‹¥ CXR é¡¯ç¤ºç®¡è·¯ç¨å¾®éæ·±ï¼Œå¯å˜—è©¦å°‡é ­éƒ¨ç¨å¾®å¾Œä»° (Extension) ä¸¦é‡æ–°å›ºå®šï¼Œå¯èƒ½ç„¡é ˆé‡æ–°æ’ç®¡ã€‚
                </div>
            </div>
            
            <!-- Background Decoration -->
            <div class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 rounded-full bg-sky-500/10 blur-3xl"></div>
        </section>

        <!-- Summary Footer -->
        <footer class="text-center pt-8 border-t border-slate-200">
            <h4 class="font-bold text-slate-700 mb-4">CXR Check List Summary</h4>
            <div class="flex flex-wrap justify-center gap-2 mb-8">
                <span class="px-3 py-1 bg-white border border-slate-200 rounded-full text-xs text-slate-500">T3-T4 Level</span>
                <span class="px-3 py-1 bg-white border border-slate-200 rounded-full text-xs text-slate-500">Carina ä¸Šæ–¹ 3-5cm</span>
                <span class="px-3 py-1 bg-white border border-slate-200 rounded-full text-xs text-slate-500">æ’é™¤æ°£èƒ¸</span>
                <span class="px-3 py-1 bg-white border border-slate-200 rounded-full text-xs text-slate-500">æª¢æŸ¥èƒƒæ³¡</span>
            </div>
            <p class="text-xs text-slate-400">
                Created with care for medical education. Not for direct clinical diagnosis.
            </p>
        </footer>

    </main>

    <script>
        // --- DATA & STATE MANAGEMENT ---
        const state = {
            tubeDepth: 21, // cm
            headPosition: 'neutral', // neutral, flexion, extension
            chartType: 'icu'
        };

        const chartData = {
            icu: {
                labels: ['ä½ç½®æ­£ç¢º (Correct)', 'å³æ”¯æ°£ç®¡æ’ç®¡ (Right Mainstem)', 'ä½ç½®éæ·º (Too Shallow)', 'é£Ÿé“æ’ç®¡ (Esophageal)'],
                data: [82, 10, 7, 1],
                colors: ['#10b981', '#f59e0b', '#f43f5e', '#64748b']
            },
            emergency: {
                labels: ['ä½ç½®æ­£ç¢º (Correct)', 'å³æ”¯æ°£ç®¡æ’ç®¡ (Right Mainstem)', 'ä½ç½®éæ·º (Too Shallow)', 'é£Ÿé“æ’ç®¡ (Esophageal)'],
                data: [75, 15, 8, 2], // Higher error rate in emergency
                colors: ['#10b981', '#f59e0b', '#f43f5e', '#64748b']
            }
        };

        // --- CANVAS VISUALIZATION (Airway Simulator) ---
        const canvas = document.getElementById('airwayCanvas');
        const ctx = canvas.getContext('2d');
        const slider = document.getElementById('tubeDepthSlider');
        const feedbackBox = document.getElementById('feedbackBox');
        const statusTitle = document.getElementById('statusTitle');
        const statusDesc = document.getElementById('statusDesc');

        // Animation Loop variables
        let animationId;

        function initCanvas() {
            // Draw initial state
            drawScene();
        }

        function drawScene() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const centerX = canvas.width / 2;
            const tracheaTop = 50;
            const carinaY = 250;
            const lungWidth = 140;
            
            // 1. Draw Lungs (Background)
            ctx.fillStyle = '#1e293b'; // Dark lung color for X-ray feel
            
            // Right Lung
            ctx.beginPath();
            ctx.ellipse(centerX - 90, carinaY + 40, 70, 100, Math.PI / 12, 0, 2 * Math.PI);
            ctx.fill();
            
            // Left Lung
            ctx.beginPath();
            ctx.ellipse(centerX + 90, carinaY + 40, 70, 90, -Math.PI / 12, 0, 2 * Math.PI);
            ctx.fill();

            // 2. Draw Airway (Trachea & Bronchi) - "Negative space" (Lighter)
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = '#94a3b8'; // Bone/Tissue color
            ctx.lineWidth = 30;

            // Trachea
            ctx.beginPath();
            ctx.moveTo(centerX, tracheaTop);
            ctx.lineTo(centerX, carinaY);
            ctx.stroke();

            // Right Main Bronchus (Steep angle)
            ctx.beginPath();
            ctx.moveTo(centerX, carinaY - 5);
            ctx.lineTo(centerX - 60, carinaY + 120);
            ctx.stroke();

            // Left Main Bronchus (More horizontal)
            ctx.beginPath();
            ctx.moveTo(centerX, carinaY - 5);
            ctx.lineTo(centerX + 80, carinaY + 100);
            ctx.stroke();

            // Carina Point (Visual marker)
            ctx.fillStyle = '#ef4444';
            ctx.beginPath();
            ctx.arc(centerX, carinaY, 3, 0, Math.PI*2);
            ctx.fill();
            ctx.font = '12px Arial';
            ctx.fillStyle = '#94a3b8';
            ctx.fillText('Carina', centerX + 15, carinaY);

            // 3. Draw Endotracheal Tube
            // Map slider value (18-28) to Y coordinates
            // 21cm is ideal (approx 4cm above carina)
            // Range logic: 
            // 18cm (Shallow) -> Y = 150
            // 21cm (Ideal) -> Y = 210
            // 26cm (Deep/Carina) -> Y = 250
            // >26cm -> Goes Right
            
            let tubeTipY;
            let tubeTipX = centerX;
            
            // Simple linear mapping for visualization
            // Base pixel depth for 18cm = 150px
            // Pixels per cm = 12
            const pixelsPerCm = 15;
            const baseCm = 18;
            const baseY = 150;
            
            tubeTipY = baseY + (state.tubeDepth - baseCm) * pixelsPerCm;

            ctx.strokeStyle = '#e0f2fe'; // Tube color (bright white/blue)
            ctx.lineWidth = 12;
            
            ctx.beginPath();
            ctx.moveTo(centerX, -10); // Start off screen
            
            if (tubeTipY <= carinaY) {
                // Above Carina
                ctx.lineTo(centerX, tubeTipY);
                ctx.stroke();
                
                // Cuff (Balloon)
                ctx.fillStyle = 'rgba(224, 242, 254, 0.4)';
                ctx.beginPath();
                ctx.ellipse(centerX, tubeTipY - 25, 12, 18, 0, 0, Math.PI*2);
                ctx.fill();
                ctx.strokeStyle = '#e0f2fe';
                ctx.lineWidth = 1;
                ctx.stroke();

            } else {
                // Below Carina -> Goes Right (Anatomy logic)
                ctx.lineTo(centerX, carinaY); // To Carina
                // Calculate vector for right bronchus
                const overflow = tubeTipY - carinaY;
                const rightAngle = Math.atan2(120, -60); // Based on bronchus lines above
                
                // Interpolate path into right bronchus
                const endX = centerX + Math.cos(rightAngle) * overflow; // Actually goes left on screen (Patient Right)
                const endY = carinaY + Math.sin(rightAngle) * overflow;
                
                ctx.quadraticCurveTo(centerX, carinaY + 5, endX, endY);
                ctx.lineWidth = 12;
                ctx.stroke();

                // Cuff (Balloon) - gets squished or hidden, simplistic drawing here
                ctx.fillStyle = 'rgba(224, 242, 254, 0.4)';
                ctx.beginPath();
                ctx.arc(endX, endY - 10, 10, 0, Math.PI*2);
                ctx.fill();
            }

            // Tube Radiopaque Line (Visual detail)
            ctx.strokeStyle = '#38bdf8';
            ctx.lineWidth = 2;
            ctx.beginPath();
            // Simplify: just a line down the middle of the tube path
            // (Omitted for complex curve math simplicity, keeping visuals clean)

            // 4. Update UI Feedback based on Depth
            updateFeedback(state.tubeDepth, tubeTipY, carinaY);
        }

        function updateFeedback(depth, tipY, carinaY) {
            const distanceToCarina = (carinaY - tipY) / 15; // Reverse map pixels to cm approx

            // Logic thresholds
            // Ideal: 3-5 cm above carina
            // Warning: < 2 cm above carina
            // Danger: Below carina
            // Shallow: > 7 cm above carina (Risk of vocal cord damage/extubation)
            
            feedbackBox.className = "p-4 rounded-lg border-l-4 transition-colors duration-300";
            
            if (depth > 25.5) {
                // Right Mainstem
                feedbackBox.classList.add("border-red-500", "bg-red-50");
                statusTitle.textContent = "âš ï¸ å±éšªï¼šå³æ”¯æ°£ç®¡æ’ç®¡ (Right Mainstem Intubation)";
                statusTitle.className = "font-bold text-red-800";
                statusDesc.textContent = "ç®¡è·¯éæ·±ï¼å·²é€²å…¥å³å´æ”¯æ°£ç®¡ã€‚é€™å°‡å°è‡´å·¦è‚ºç„¡æ³•é€šæ°£ (å¡Œé™·)ï¼Œä¸”å³è‚ºæ‰¿å—éé«˜å£“åŠ› (æ°£å£“å‚·)ã€‚";
            } else if (depth > 24) {
                // Too Deep Warning
                feedbackBox.classList.add("border-amber-500", "bg-amber-50");
                statusTitle.textContent = "âš ï¸ è­¦å‘Šï¼šä½ç½®éæ·± (Too Deep)";
                statusTitle.className = "font-bold text-amber-800";
                statusDesc.textContent = "å°–ç«¯æ¥µåº¦æ¥è¿‘éš†çª (Carina)ã€‚é ­éƒ¨ç¨ä½œå±ˆæ›²å¯èƒ½å°è‡´å–®è‚ºæ’ç®¡ã€‚";
            } else if (depth >= 20 && depth <= 24) {
                // Ideal
                feedbackBox.classList.add("border-green-500", "bg-green-50");
                statusTitle.textContent = "âœ… ä½ç½®å®Œç¾ (Ideal Position)";
                statusTitle.className = "font-bold text-green-800";
                statusDesc.textContent = `å°–ç«¯ä½æ–¼éš†çªä¸Šæ–¹ç´„ ${(25.5 - depth).toFixed(1)} cmã€‚é€™æ˜¯æœ€ä½³å®‰å…¨ç¯„åœ (T3-T4)ã€‚`;
            } else {
                // Too Shallow
                feedbackBox.classList.add("border-rose-500", "bg-rose-50");
                statusTitle.textContent = "âš ï¸ è­¦å‘Šï¼šä½ç½®éæ·º (Too Shallow)";
                statusTitle.className = "font-bold text-rose-800";
                statusDesc.textContent = "ç®¡è·¯å°–ç«¯ä½ç½®éé«˜ã€‚æ°£å›Š (Cuff) å¯èƒ½ä½æ–¼è²å¸¶ä¹‹é–“å°è‡´æå‚·ï¼Œæˆ–å› é ­éƒ¨å¾Œä»°è€Œæ„å¤–æ‹”ç®¡ (Accidental Extubation)ã€‚";
            }
        }

        slider.addEventListener('input', (e) => {
            state.tubeDepth = parseFloat(e.target.value);
            // Reset head position when manually moving slider to avoid confusion
            resetHeadButtons(); 
            drawScene();
        });

        // --- CHART.JS VISUALIZATION ---
        let posChart;

        function initChart() {
            const ctxChart = document.getElementById('positionChart').getContext('2d');
            
            // Common Config
            Chart.defaults.font.family = "'Noto Sans TC', sans-serif";
            
            posChart = new Chart(ctxChart, {
                type: 'doughnut',
                data: {
                    labels: chartData.icu.labels,
                    datasets: [{
                        data: chartData.icu.data,
                        backgroundColor: chartData.icu.colors,
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${context.label}: ${context.raw}%`;
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'ICU æ’ç®¡å¾Œ CXR ä½ç½®ç•°å¸¸æ¯”ä¾‹',
                            font: { size: 16 }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        window.updateChartData = function(type) {
            state.chartType = type;
            const newData = chartData[type];
            
            posChart.data.datasets[0].data = newData.data;
            posChart.options.plugins.title.text = type === 'icu' 
                ? 'ICU æ’ç®¡å¾Œ CXR ä½ç½®ç•°å¸¸æ¯”ä¾‹' 
                : 'æ€¥è¨ºæ’ç®¡å¾Œ CXR ä½ç½®ç•°å¸¸æ¯”ä¾‹ (é¢¨éšªè¼ƒé«˜)';
            
            posChart.update();
        };


        // --- HEAD POSITION INTERACTION ---
        const btnNeutral = document.getElementById('headNeutral');
        const btnFlex = document.getElementById('headFlexion');
        const btnExt = document.getElementById('headExtension');
        const buttons = [btnNeutral, btnFlex, btnExt];

        function resetHeadButtons() {
            buttons.forEach(btn => {
                btn.classList.remove('ring-2', 'ring-sky-500');
            });
            state.headPosition = 'neutral';
        }

        function setHeadPosition(pos, btn) {
            // Remove active style from all
            buttons.forEach(b => b.classList.remove('ring-2', 'ring-sky-500'));
            // Add to clicked
            btn.classList.add('ring-2', 'ring-sky-500');
            
            state.headPosition = pos;
            
            // Affect the slider/visualization
            // Logic: 
            // Flexion -> Tube goes DEEP (add depth cm)
            // Extension -> Tube goes SHALLOW (subtract depth cm)
            // Assume base is 21 (Neutral)
            
            let baseVal = parseFloat(slider.value);
            // We need a base reference. For this UI, we just apply a delta to the current visual
            // To prevent infinite addition, we reset to a "base" logically, but simpler is just visual jump
            
            // Better logic: The slider represents the "Fixed at Lip" length.
            // Head movement changes the *Effective* depth relative to carina.
            // So we update the slider value to show what happens.
            
            let currentVal = parseFloat(slider.value);
            let shift = 0;

            if (pos === 'flexion') shift = 1.9; // Goes deeper
            if (pos === 'extension') shift = -1.9; // Pulls out
            
            // Note: This is a simplification. Usually we say "The tip moves". 
            // If the tube is fixed at teeth at 22cm.
            // Flexion: Tip moves DOWN (closer to carina). It looks like the tube got longer inside.
            // So effective depth increases.
            
            // To show this effect nicely, we animate the slider slightly? 
            // Or just snap it. Let's snap it but warn user.
            
            // Actually, let's just modify the slider value to simulate the effect
            // But we must debounce it so user doesn't click flex flex flex and push it to 40cm.
            // Let's rely on the visual reset.
            
            // For this interaction design: These buttons are educational demos. 
            // They will set the slider to a specific demo scenario or modify current if within range.
            
            let newVal = currentVal + shift;
            if (newVal > 28) newVal = 28;
            if (newVal < 18) newVal = 18;
            
            slider.value = newVal;
            state.tubeDepth = newVal;
            drawScene();
        }

        btnNeutral.addEventListener('click', () => {
            // Neutral doesn't move it, but restores if we tracked state. 
            // Here we just highlight it to signify "Standard".
            resetHeadButtons();
            btnNeutral.classList.add('ring-2', 'ring-sky-500');
        });

        btnFlex.addEventListener('click', () => {
            // Simulate Flexion effect on current pos
            setHeadPosition('flexion', btnFlex);
        });

        btnExt.addEventListener('click', () => {
            // Simulate Extension effect on current pos
            setHeadPosition('extension', btnExt);
        });


        // --- INITIALIZATION ---
        window.addEventListener('load', () => {
            initCanvas();
            initChart();
            
            // Responsive Canvas Resize
            window.addEventListener('resize', () => {
               // Redraw if needed, CSS handles scaling but pixel density might need recalc
               // For simple chart/schematic, CSS scaling is usually enough
            });
        });

    </script>
</body>
</html>
